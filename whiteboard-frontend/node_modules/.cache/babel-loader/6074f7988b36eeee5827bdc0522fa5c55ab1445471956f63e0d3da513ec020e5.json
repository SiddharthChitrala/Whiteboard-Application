{"ast":null,"code":"var _jsxFileName = \"D:\\\\full stack mern,mean,java\\\\Whiteboard Application\\\\whiteboard-frontend\\\\src\\\\pages\\\\canvas\\\\Room.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\n// import { toast } from \"react-toastify\";\nimport Canvas from \"./canvas\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Room = ({\n  userNo,\n  socket,\n  setUsers,\n  setUserNo\n}) => {\n  _s();\n  const canvasRef = useRef(null);\n  const ctx = useRef(null);\n  const [color, setColor] = useState(\"#000000\");\n  const [elements, setElements] = useState([]);\n  const [history, setHistory] = useState([]);\n  const [tool, setTool] = useState(\"pencil\");\n  useEffect(() => {\n    socket.on(\"message\", data => {\n      alert(data.message);\n    });\n  }, [socket]);\n  useEffect(() => {\n    socket.on(\"users\", data => {\n      setUsers(data);\n      setUserNo(data.length);\n    });\n  }, [setUsers, setUserNo, socket]);\n  const clearCanvas = () => {\n    const canvas = canvasRef.current;\n    const context = canvas.getContext(\"2d\");\n    context.fillStyle = \"white\";\n    context.fillRect(0, 0, canvas.width, canvas.height);\n    setElements([]);\n  };\n  const undo = () => {\n    setHistory(prevHistory => [...prevHistory, elements[elements.length - 1]]);\n    setElements(prevElements => prevElements.filter((ele, index) => index !== elements.length - 1));\n  };\n  const redo = () => {\n    setElements(prevElements => [...prevElements, history[history.length - 1]]);\n    setHistory(prevHistory => prevHistory.filter((ele, index) => index !== history.length - 1));\n  };\n  useLayoutEffect(() => {\n    const canvas = document.getElementById(\"canvas\");\n    const context = canvas.getContext(\"2d\");\n    const roughCanvas = rough.canvas(canvas);\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    context.save();\n    context.translate(panOffset.x, panOffset.y);\n    elements.forEach(element => {\n      if (action === \"writing\" && selectedElement.id === element.id) return;\n      drawElement(roughCanvas, context, element);\n    });\n    context.restore();\n  }, [elements, action, selectedElement, panOffset]);\n  useEffect(() => {\n    const undoRedoFunction = event => {\n      if ((event.metaKey || event.ctrlKey) && event.key === \"z\") {\n        if (event.shiftKey) {\n          redo();\n        } else {\n          undo();\n        }\n      }\n    };\n    document.addEventListener(\"keydown\", undoRedoFunction);\n    return () => {\n      document.removeEventListener(\"keydown\", undoRedoFunction);\n    };\n  }, [undo, redo]);\n  useEffect(() => {\n    const panFunction = event => {\n      setPanOffset(prevState => ({\n        x: prevState.x - event.deltaX,\n        y: prevState.y - event.deltaY\n      }));\n    };\n    document.addEventListener(\"wheel\", panFunction);\n    return () => {\n      document.removeEventListener(\"wheel\", panFunction);\n    };\n  }, []);\n  useEffect(() => {\n    const textArea = textAreaRef.current;\n    if (action === \"writing\") {\n      setTimeout(() => {\n        textArea.focus();\n        textArea.value = selectedElement.text;\n      }, 0);\n    }\n  }, [action, selectedElement]);\n  const updateElement = (id, x1, y1, x2, y2, type, options) => {\n    const elementsCopy = [...elements];\n    switch (type) {\n      case \"line\":\n      case \"rectangle\":\n        elementsCopy[id] = createElement(id, x1, y1, x2, y2, type);\n        break;\n      case \"pencil\":\n        elementsCopy[id].points = [...elementsCopy[id].points, {\n          x: x2,\n          y: y2\n        }];\n        break;\n      case \"text\":\n        const textWidth = document.getElementById(\"canvas\").getContext(\"2d\").measureText(options.text).width;\n        const textHeight = 24;\n        elementsCopy[id] = {\n          ...createElement(id, x1, y1, x1 + textWidth, y1 + textHeight, type),\n          text: options.text\n        };\n        break;\n      default:\n        throw new Error(`Type not recognised: ${type}`);\n    }\n    setElements(elementsCopy, true);\n  };\n  const getMouseCoordinates = event => {\n    const clientX = event.clientX - panOffset.x;\n    const clientY = event.clientY - panOffset.y;\n    return {\n      clientX,\n      clientY\n    };\n  };\n  const handleMouseDown = event => {\n    if (action === \"writing\") return;\n    const {\n      clientX,\n      clientY\n    } = getMouseCoordinates(event);\n    if (event.button === 1 || pressedKeys.has(\" \")) {\n      setAction(\"panning\");\n      setStartPanMousePosition({\n        x: clientX,\n        y: clientY\n      });\n      return;\n    }\n    if (tool === \"selection\") {\n      const element = getElementAtPosition(clientX, clientY, elements);\n      if (element) {\n        if (element.type === \"pencil\") {\n          const xOffsets = element.points.map(point => clientX - point.x);\n          const yOffsets = element.points.map(point => clientY - point.y);\n          setSelectedElement({\n            ...element,\n            xOffsets,\n            yOffsets\n          });\n        } else {\n          const offsetX = clientX - element.x1;\n          const offsetY = clientY - element.y1;\n          setSelectedElement({\n            ...element,\n            offsetX,\n            offsetY\n          });\n        }\n        setElements(prevState => prevState);\n        if (element.position === \"inside\") {\n          setAction(\"moving\");\n        } else {\n          setAction(\"resizing\");\n        }\n      }\n    } else {\n      const id = elements.length;\n      const element = createElement(id, clientX, clientY, clientX, clientY, tool);\n      setElements(prevState => [...prevState, element]);\n      setSelectedElement(element);\n      setAction(tool === \"text\" ? \"writing\" : \"drawing\");\n    }\n  };\n  const handleMouseMove = event => {\n    const {\n      clientX,\n      clientY\n    } = getMouseCoordinates(event);\n    if (action === \"panning\") {\n      const deltaX = clientX - startPanMousePosition.x;\n      const deltaY = clientY - startPanMousePosition.y;\n      setPanOffset({\n        x: panOffset.x + deltaX,\n        y: panOffset.y + deltaY\n      });\n      return;\n    }\n    if (tool === \"selection\") {\n      const element = getElementAtPosition(clientX, clientY, elements);\n      event.target.style.cursor = element ? cursorForPosition(element.position) : \"default\";\n    }\n    if (action === \"drawing\") {\n      const index = elements.length - 1;\n      const {\n        x1,\n        y1\n      } = elements[index];\n      updateElement(index, x1, y1, clientX, clientY, tool);\n    } else if (action === \"moving\") {\n      if (selectedElement.type === \"pencil\") {\n        const newPoints = selectedElement.points.map((_, index) => ({\n          x: clientX - selectedElement.xOffsets[index],\n          y: clientY - selectedElement.yOffsets[index]\n        }));\n        const elementsCopy = [...elements];\n        elementsCopy[selectedElement.id] = {\n          ...elementsCopy[selectedElement.id],\n          points: newPoints\n        };\n        setElements(elementsCopy, true);\n      } else {\n        const {\n          id,\n          x1,\n          x2,\n          y1,\n          y2,\n          type,\n          offsetX,\n          offsetY\n        } = selectedElement;\n        const width = x2 - x1;\n        const height = y2 - y1;\n        const newX1 = clientX - offsetX;\n        const newY1 = clientY - offsetY;\n        const options = type === \"text\" ? {\n          text: selectedElement.text\n        } : {};\n        updateElement(id, newX1, newY1, newX1 + width, newY1 + height, type, options);\n      }\n    } else if (action === \"resizing\") {\n      const {\n        id,\n        type,\n        position,\n        ...coordinates\n      } = selectedElement;\n      const {\n        x1,\n        y1,\n        x2,\n        y2\n      } = resizedCoordinates(clientX, clientY, position, coordinates);\n      updateElement(id, x1, y1, x2, y2, type);\n    }\n  };\n  const handleMouseUp = event => {\n    const {\n      clientX,\n      clientY\n    } = getMouseCoordinates(event);\n    if (selectedElement) {\n      if (selectedElement.type === \"text\" && clientX - selectedElement.offsetX === selectedElement.x1 && clientY - selectedElement.offsetY === selectedElement.y1) {\n        setAction(\"writing\");\n        return;\n      }\n      const index = selectedElement.id;\n      const {\n        id,\n        type\n      } = elements[index];\n      if ((action === \"drawing\" || action === \"resizing\") && adjustmentRequired(type)) {\n        const {\n          x1,\n          y1,\n          x2,\n          y2\n        } = adjustElementCoordinates(elements[index]);\n        updateElement(id, x1, y1, x2, y2, type);\n      }\n    }\n    if (action === \"writing\") return;\n    setAction(\"none\");\n    setSelectedElement(null);\n  };\n  const handleBlur = event => {\n    const {\n      id,\n      x1,\n      y1,\n      type\n    } = selectedElement;\n    setAction(\"none\");\n    setSelectedElement(null);\n    updateElement(id, x1, y1, null, null, type, {\n      text: event.target.value\n    });\n  };\n  const saveImageToLocal = () => {\n    const canvas = canvasRef.current;\n    const link = document.createElement('a');\n    canvas.toBlob(blob => {\n      const url = URL.createObjectURL(blob);\n      link.href = url;\n      link.download = 'canvas.png';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n    }, 'image/png');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container-fluid\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row\",\n      children: /*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"display-5 pt-4 pb-3 text-center\",\n        children: [\"Whiteboard -\", userNo]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row justify-content-center align-items-center text-center py-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-2\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"color-picker d-flex align-items-center justify-content-center\",\n          children: [\"Color Picker : \\xA0\", /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"color\",\n            value: color,\n            onChange: e => setColor(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 293,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-check form-check-inline\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"form-check-input\",\n            type: \"radio\",\n            name: \"tools\",\n            id: \"pencil\",\n            value: \"pencil\",\n            checked: tool === \"pencil\",\n            onClick: e => setTool(e.target.value),\n            readOnly: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 302,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"form-check-label\",\n            htmlFor: \"pencil\",\n            children: \"Pencil\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-check form-check-inline\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"form-check-input\",\n            type: \"radio\",\n            name: \"tools\",\n            id: \"line\",\n            value: \"line\",\n            checked: tool === \"line\",\n            onClick: e => setTool(e.target.value),\n            readOnly: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 317,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"form-check-label\",\n            htmlFor: \"line\",\n            children: \"Line\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-check form-check-inline\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"form-check-input\",\n            type: \"radio\",\n            name: \"tools\",\n            id: \"rect\",\n            value: \"rect\",\n            checked: tool === \"rect\",\n            onClick: e => setTool(e.target.value),\n            readOnly: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 332,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"form-check-label\",\n            htmlFor: \"rect\",\n            children: \"Rectangle\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 342,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 331,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"btn btn-outline-primary\",\n          disabled: elements.length === 0,\n          onClick: () => undo(),\n          children: \"Undo\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 11\n        }, this), \"\\xA0\\xA0\", /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"btn btn-outline-primary ml-1\",\n          disabled: history.length < 1,\n          onClick: () => redo(),\n          children: \"Redo\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 358,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-1\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"color-picker d-flex align-items-center justify-content-center col\",\n            children: /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"button\",\n              className: \"btn btn-danger\",\n              value: \"clear canvas\",\n              onClick: clearCanvas\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 372,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 371,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-primary\",\n              onClick: saveImageToLocal,\n              children: \"Download Image\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 381,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 379,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row justify-content-start align-items-start text-start py-2\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          id: \"text\",\n          checked: tool === \"text\",\n          onChange: () => setTool(\"text\")\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"text\",\n          children: \"Text\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row\",\n      children: /*#__PURE__*/_jsxDEV(Canvas, {\n        canvasRef: canvasRef,\n        ctx: ctx,\n        color: color,\n        setElements: setElements,\n        elements: elements,\n        tool: tool,\n        socket: socket\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 398,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 397,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 283,\n    columnNumber: 5\n  }, this);\n};\n_s(Room, \"MI1J16ZTajUbHj1v1qnFlNbMMps=\");\n_c = Room;\nexport default Room;\nvar _c;\n$RefreshReg$(_c, \"Room\");","map":{"version":3,"names":["React","useEffect","useRef","useState","Canvas","jsxDEV","_jsxDEV","Room","userNo","socket","setUsers","setUserNo","_s","canvasRef","ctx","color","setColor","elements","setElements","history","setHistory","tool","setTool","on","data","alert","message","length","clearCanvas","canvas","current","context","getContext","fillStyle","fillRect","width","height","undo","prevHistory","prevElements","filter","ele","index","redo","useLayoutEffect","document","getElementById","roughCanvas","rough","clearRect","save","translate","panOffset","x","y","forEach","element","action","selectedElement","id","drawElement","restore","undoRedoFunction","event","metaKey","ctrlKey","key","shiftKey","addEventListener","removeEventListener","panFunction","setPanOffset","prevState","deltaX","deltaY","textArea","textAreaRef","setTimeout","focus","value","text","updateElement","x1","y1","x2","y2","type","options","elementsCopy","createElement","points","textWidth","measureText","textHeight","Error","getMouseCoordinates","clientX","clientY","handleMouseDown","button","pressedKeys","has","setAction","setStartPanMousePosition","getElementAtPosition","xOffsets","map","point","yOffsets","setSelectedElement","offsetX","offsetY","position","handleMouseMove","startPanMousePosition","target","style","cursor","cursorForPosition","newPoints","_","newX1","newY1","coordinates","resizedCoordinates","handleMouseUp","adjustmentRequired","adjustElementCoordinates","handleBlur","saveImageToLocal","link","toBlob","blob","url","URL","createObjectURL","href","download","body","appendChild","click","removeChild","revokeObjectURL","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onChange","e","name","checked","onClick","readOnly","htmlFor","disabled","_c","$RefreshReg$"],"sources":["D:/full stack mern,mean,java/Whiteboard Application/whiteboard-frontend/src/pages/canvas/Room.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\n// import { toast } from \"react-toastify\";\r\nimport Canvas from \"./canvas\";\r\n\r\nconst Room = ({ userNo, socket, setUsers, setUserNo }) => {\r\n  const canvasRef = useRef(null);\r\n  const ctx = useRef(null);\r\n  const [color, setColor] = useState(\"#000000\");\r\n  const [elements, setElements] = useState([]);\r\n  const [history, setHistory] = useState([]);\r\n  const [tool, setTool] = useState(\"pencil\");\r\n\r\n  useEffect(() => {\r\n    socket.on(\"message\", (data) => {\r\n      alert(data.message);\r\n    });\r\n  }, [socket]);\r\n  useEffect(() => {\r\n    socket.on(\"users\", (data) => {\r\n      setUsers(data);\r\n      setUserNo(data.length);\r\n    });\r\n  }, [setUsers, setUserNo, socket]);\r\n\r\n  const clearCanvas = () => {\r\n    const canvas = canvasRef.current;\r\n    const context = canvas.getContext(\"2d\");\r\n    context.fillStyle = \"white\";\r\n    context.fillRect(0, 0, canvas.width, canvas.height);\r\n    setElements([]);\r\n  };\r\n\r\n  const undo = () => {\r\n    setHistory((prevHistory) => [\r\n      ...prevHistory,\r\n      elements[elements.length - 1],\r\n    ]);\r\n    setElements((prevElements) =>\r\n      prevElements.filter((ele, index) => index !== elements.length - 1)\r\n    );\r\n  };\r\n  const redo = () => {\r\n    setElements((prevElements) => [\r\n      ...prevElements,\r\n      history[history.length - 1],\r\n    ]);\r\n    setHistory((prevHistory) =>\r\n      prevHistory.filter((ele, index) => index !== history.length - 1)\r\n    );\r\n  };\r\n  useLayoutEffect(() => {\r\n    const canvas = document.getElementById(\"canvas\");\r\n    const context = canvas.getContext(\"2d\");\r\n    const roughCanvas = rough.canvas(canvas);\r\n\r\n    context.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    context.save();\r\n    context.translate(panOffset.x, panOffset.y);\r\n\r\n    elements.forEach(element => {\r\n      if (action === \"writing\" && selectedElement.id === element.id) return;\r\n      drawElement(roughCanvas, context, element);\r\n    });\r\n    context.restore();\r\n  }, [elements, action, selectedElement, panOffset]);\r\n\r\n  useEffect(() => {\r\n    const undoRedoFunction = event => {\r\n      if ((event.metaKey || event.ctrlKey) && event.key === \"z\") {\r\n        if (event.shiftKey) {\r\n          redo();\r\n        } else {\r\n          undo();\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"keydown\", undoRedoFunction);\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", undoRedoFunction);\r\n    };\r\n  }, [undo, redo]);\r\n\r\n  useEffect(() => {\r\n    const panFunction = event => {\r\n      setPanOffset(prevState => ({\r\n        x: prevState.x - event.deltaX,\r\n        y: prevState.y - event.deltaY,\r\n      }));\r\n    };\r\n\r\n    document.addEventListener(\"wheel\", panFunction);\r\n    return () => {\r\n      document.removeEventListener(\"wheel\", panFunction);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const textArea = textAreaRef.current;\r\n    if (action === \"writing\") {\r\n      setTimeout(() => {\r\n        textArea.focus();\r\n        textArea.value = selectedElement.text;\r\n      }, 0);\r\n    }\r\n  }, [action, selectedElement]);\r\n\r\n  const updateElement = (id, x1, y1, x2, y2, type, options) => {\r\n    const elementsCopy = [...elements];\r\n\r\n    switch (type) {\r\n      case \"line\":\r\n      case \"rectangle\":\r\n        elementsCopy[id] = createElement(id, x1, y1, x2, y2, type);\r\n        break;\r\n      case \"pencil\":\r\n        elementsCopy[id].points = [...elementsCopy[id].points, { x: x2, y: y2 }];\r\n        break;\r\n      case \"text\":\r\n        const textWidth = document\r\n          .getElementById(\"canvas\")\r\n          .getContext(\"2d\")\r\n          .measureText(options.text).width;\r\n        const textHeight = 24;\r\n        elementsCopy[id] = {\r\n          ...createElement(id, x1, y1, x1 + textWidth, y1 + textHeight, type),\r\n          text: options.text,\r\n        };\r\n        break;\r\n      default:\r\n        throw new Error(`Type not recognised: ${type}`);\r\n    }\r\n\r\n    setElements(elementsCopy, true);\r\n  };\r\n\r\n  const getMouseCoordinates = event => {\r\n    const clientX = event.clientX - panOffset.x;\r\n    const clientY = event.clientY - panOffset.y;\r\n    return { clientX, clientY };\r\n  };\r\n\r\n  const handleMouseDown = event => {\r\n    if (action === \"writing\") return;\r\n\r\n    const { clientX, clientY } = getMouseCoordinates(event);\r\n\r\n    if (event.button === 1 || pressedKeys.has(\" \")) {\r\n      setAction(\"panning\");\r\n      setStartPanMousePosition({ x: clientX, y: clientY });\r\n      return;\r\n    }\r\n\r\n    if (tool === \"selection\") {\r\n      const element = getElementAtPosition(clientX, clientY, elements);\r\n      if (element) {\r\n        if (element.type === \"pencil\") {\r\n          const xOffsets = element.points.map(point => clientX - point.x);\r\n          const yOffsets = element.points.map(point => clientY - point.y);\r\n          setSelectedElement({ ...element, xOffsets, yOffsets });\r\n        } else {\r\n          const offsetX = clientX - element.x1;\r\n          const offsetY = clientY - element.y1;\r\n          setSelectedElement({ ...element, offsetX, offsetY });\r\n        }\r\n        setElements(prevState => prevState);\r\n\r\n        if (element.position === \"inside\") {\r\n          setAction(\"moving\");\r\n        } else {\r\n          setAction(\"resizing\");\r\n        }\r\n      }\r\n    } else {\r\n      const id = elements.length;\r\n      const element = createElement(id, clientX, clientY, clientX, clientY, tool);\r\n      setElements(prevState => [...prevState, element]);\r\n      setSelectedElement(element);\r\n\r\n      setAction(tool === \"text\" ? \"writing\" : \"drawing\");\r\n    }\r\n  };\r\n\r\n  const handleMouseMove = event => {\r\n    const { clientX, clientY } = getMouseCoordinates(event);\r\n\r\n    if (action === \"panning\") {\r\n      const deltaX = clientX - startPanMousePosition.x;\r\n      const deltaY = clientY - startPanMousePosition.y;\r\n      setPanOffset({\r\n        x: panOffset.x + deltaX,\r\n        y: panOffset.y + deltaY,\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (tool === \"selection\") {\r\n      const element = getElementAtPosition(clientX, clientY, elements);\r\n      event.target.style.cursor = element ? cursorForPosition(element.position) : \"default\";\r\n    }\r\n\r\n    if (action === \"drawing\") {\r\n      const index = elements.length - 1;\r\n      const { x1, y1 } = elements[index];\r\n      updateElement(index, x1, y1, clientX, clientY, tool);\r\n    } else if (action === \"moving\") {\r\n      if (selectedElement.type === \"pencil\") {\r\n        const newPoints = selectedElement.points.map((_, index) => ({\r\n          x: clientX - selectedElement.xOffsets[index],\r\n          y: clientY - selectedElement.yOffsets[index],\r\n        }));\r\n        const elementsCopy = [...elements];\r\n        elementsCopy[selectedElement.id] = {\r\n          ...elementsCopy[selectedElement.id],\r\n          points: newPoints,\r\n        };\r\n        setElements(elementsCopy, true);\r\n      } else {\r\n        const { id, x1, x2, y1, y2, type, offsetX, offsetY } = selectedElement;\r\n        const width = x2 - x1;\r\n        const height = y2 - y1;\r\n        const newX1 = clientX - offsetX;\r\n        const newY1 = clientY - offsetY;\r\n        const options = type === \"text\" ? { text: selectedElement.text } : {};\r\n        updateElement(id, newX1, newY1, newX1 + width, newY1 + height, type, options);\r\n      }\r\n    } else if (action === \"resizing\") {\r\n      const { id, type, position, ...coordinates } = selectedElement;\r\n      const { x1, y1, x2, y2 } = resizedCoordinates(clientX, clientY, position, coordinates);\r\n      updateElement(id, x1, y1, x2, y2, type);\r\n    }\r\n  };\r\n\r\n  const handleMouseUp = event => {\r\n    const { clientX, clientY } = getMouseCoordinates(event);\r\n    if (selectedElement) {\r\n      if (\r\n        selectedElement.type === \"text\" &&\r\n        clientX - selectedElement.offsetX === selectedElement.x1 &&\r\n        clientY - selectedElement.offsetY === selectedElement.y1\r\n      ) {\r\n        setAction(\"writing\");\r\n        return;\r\n      }\r\n\r\n      const index = selectedElement.id;\r\n      const { id, type } = elements[index];\r\n      if ((action === \"drawing\" || action === \"resizing\") && adjustmentRequired(type)) {\r\n        const { x1, y1, x2, y2 } = adjustElementCoordinates(elements[index]);\r\n        updateElement(id, x1, y1, x2, y2, type);\r\n      }\r\n    }\r\n\r\n    if (action === \"writing\") return;\r\n\r\n    setAction(\"none\");\r\n    setSelectedElement(null);\r\n  };\r\n\r\n  const handleBlur = event => {\r\n    const { id, x1, y1, type } = selectedElement;\r\n    setAction(\"none\");\r\n    setSelectedElement(null);\r\n    updateElement(id, x1, y1, null, null, type, { text: event.target.value });\r\n  };\r\n  const saveImageToLocal = () => {\r\n    const canvas = canvasRef.current;\r\n    const link = document.createElement('a');\r\n\r\n    canvas.toBlob((blob) => {\r\n      const url = URL.createObjectURL(blob);\r\n      link.href = url;\r\n      link.download = 'canvas.png';\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      URL.revokeObjectURL(url);\r\n    }, 'image/png');\r\n  };\r\n\r\n  return (\r\n    <div className=\"container-fluid\">\r\n      <div className=\"row\">\r\n        <h1 className=\"display-5 pt-4 pb-3 text-center\">\r\n          Whiteboard -{userNo}\r\n        </h1>\r\n      </div>\r\n      <div className=\"row justify-content-center align-items-center text-center py-2\">\r\n        <div className=\"col-md-2\">\r\n          <div className=\"color-picker d-flex align-items-center justify-content-center\">\r\n            Color Picker : &nbsp;\r\n            <input\r\n              type=\"color\"\r\n              value={color}\r\n              onChange={(e) => setColor(e.target.value)}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"col-md-3\">\r\n          <div className=\"form-check form-check-inline\">\r\n            <input\r\n              className=\"form-check-input\"\r\n              type=\"radio\"\r\n              name=\"tools\"\r\n              id=\"pencil\"\r\n              value=\"pencil\"\r\n              checked={tool === \"pencil\"}\r\n              onClick={(e) => setTool(e.target.value)}\r\n              readOnly={true}\r\n            />\r\n            <label className=\"form-check-label\" htmlFor=\"pencil\">\r\n              Pencil\r\n            </label>\r\n          </div>\r\n          <div className=\"form-check form-check-inline\">\r\n            <input\r\n              className=\"form-check-input\"\r\n              type=\"radio\"\r\n              name=\"tools\"\r\n              id=\"line\"\r\n              value=\"line\"\r\n              checked={tool === \"line\"}\r\n              onClick={(e) => setTool(e.target.value)}\r\n              readOnly={true}\r\n            />\r\n            <label className=\"form-check-label\" htmlFor=\"line\">\r\n              Line\r\n            </label>\r\n          </div>\r\n          <div className=\"form-check form-check-inline\">\r\n            <input\r\n              className=\"form-check-input\"\r\n              type=\"radio\"\r\n              name=\"tools\"\r\n              id=\"rect\"\r\n              value=\"rect\"\r\n              checked={tool === \"rect\"}\r\n              onClick={(e) => setTool(e.target.value)}\r\n              readOnly={true}\r\n            />\r\n            <label className=\"form-check-label\" htmlFor=\"rect\">\r\n              Rectangle\r\n            </label>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"col-md-2\">\r\n          <button\r\n            type=\"button\"\r\n            className=\"btn btn-outline-primary\"\r\n            disabled={elements.length === 0}\r\n            onClick={() => undo()}\r\n          >\r\n            Undo\r\n          </button>\r\n          &nbsp;&nbsp;\r\n          <button\r\n            type=\"button\"\r\n            className=\"btn btn-outline-primary ml-1\"\r\n            disabled={history.length < 1}\r\n            onClick={() => redo()}\r\n          >\r\n            Redo\r\n          </button>\r\n\r\n        </div>\r\n\r\n        <div className=\"col-md-1\">\r\n          <div className=\"row\">\r\n            <div className=\"color-picker d-flex align-items-center justify-content-center col\">\r\n              <input\r\n                type=\"button\"\r\n                className=\"btn btn-danger\"\r\n                value=\"clear canvas\"\r\n                onClick={clearCanvas}\r\n              />\r\n            </div>\r\n            <div className=\"col\">\r\n\r\n              <button className=\"btn btn-primary\" onClick={saveImageToLocal}>Download Image</button>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n\r\n\r\n\r\n      </div>\r\n\r\n      <div className=\"row justify-content-start align-items-start text-start py-2\">\r\n        <div className=\"col\">\r\n          <input type=\"radio\" id=\"text\" checked={tool === \"text\"} onChange={() => setTool(\"text\")} />\r\n          <label htmlFor=\"text\">Text</label>\r\n        </div>\r\n      </div>\r\n      <div className=\"row\">\r\n        <Canvas\r\n          canvasRef={canvasRef}\r\n          ctx={ctx}\r\n          color={color}\r\n          setElements={setElements}\r\n          elements={elements}\r\n          tool={tool}\r\n          socket={socket}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Room;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}